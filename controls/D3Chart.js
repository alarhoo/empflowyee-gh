sap.ui.define(["sap/ui/core/Control","sap/ui/core/HTML","sap/ui/core/ResizeHandler","sap/m/MessageToast","./../lib/d3.v7.min","./../lib/d3-org-chart","./../lib/d3-flextree"],function(t,e,a,r){"use strict";return t.extend("com.alarhoo.empflowyee.controls.D3Chart",{metadata:{properties:{chartType:{type:"string",defaultValue:"bar"},title:{type:"string",defaultValue:""},height:{type:"string",defaultValue:"400"},xAxisLabel:{type:"string",defaultValue:""},yAxisLabel:{type:"string",defaultValue:""},showLegend:{type:"boolean",defaultValue:false}},aggregations:{htmlContainer:{type:"sap.ui.core.HTML",multiple:false,visibility:"hidden"},data:{type:"sap.ui.base.ManagedObject"}}},init:function(){this._containerId=this.getId()+"--chart-container";this.setAggregation("htmlContainer",new e({content:`<svg id="${this._containerId}" style="height: '100%'"></svg>`}))},exit:function(){if(this._resizeHandlerId){a.deregister(this._resizeHandlerId)}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("d3-chart");t.openEnd();t.renderControl(e.getAggregation("htmlContainer"));t.close("div")}},onBeforeRendering:function(){if(this._resizeHandlerId){a.deregister(this._resizeHandlerId)}},onAfterRendering:function(){this._resizeHandlerId=a.register(this,this._onResize.bind(this));this._renderChart()},_onResize:function(){this._renderChart()},_renderChart:function(){const t=d3.select(`#${this._containerId}`);t.selectAll("*").remove();const e=this.$().width();const a=this.getHeight();t.attr("width",e);t.attr("height",a);try{const r=this.getBinding("data");if(!r){throw new Error("No data binding found.")}const n=r.getContexts().map(t=>t.getObject());if(!Array.isArray(n)||n.length===0){throw new Error("No data found to render chart.")}const i=this.getChartType();switch(i){case"bubble":this._renderBubbleChart(t,e,a,n);break;case"bar":this._renderBarChart(t,e,a,n);break;case"groupedBar":this._renderGroupedBarChart(t,e,a,n);break;case"pie":this._renderPieChart(t,e,a,n);break;case"microDonut":this._renderMicroDonutChart(t,e,a,n);break;case"org":this._renderOrgChart(`#${this._containerId}`,n);break;default:throw new Error(`Unsupported chart type: ${i}`)}if(this.getTitle()){t.append("text").attr("x",e/2).attr("y",20).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text(this.getTitle())}if(this.getXAxisLabel()){t.append("text").attr("x",e/2).attr("y",a-10).attr("text-anchor","middle").text(this.getXAxisLabel())}if(this.getYAxisLabel()){t.append("text").attr("text-anchor","middle").attr("transform",`translate(15, ${a/2}) rotate(-90)`).text(this.getYAxisLabel())}if(this.getShowLegend()){const a=this.getChartType();const n=r.getContexts().map(t=>t.getObject());const i=Array.from(new Set(a==="groupedBar"?n.flatMap(t=>t.values.map(t=>t.category)):n.map(t=>t.name||t.category||t.group)));const d=d3.scaleOrdinal().domain(i).range(d3.schemeCategory10);const o=t.append("g").attr("transform",`translate(${e-120}, 40)`);o.selectAll("rect").data(i).enter().append("rect").attr("x",0).attr("y",(t,e)=>e*20).attr("width",12).attr("height",12).attr("fill",t=>d(t));o.selectAll("text").data(i).enter().append("text").attr("x",18).attr("y",(t,e)=>e*20+10).text(t=>t)}}catch(e){t.append("text").attr("x","50%").attr("y","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("fill","#999").style("font-size","14px").text(`Unable to render chart: ${e.message}`);r.show(`Chart rendering failed: ${e.message}`);console.error(e)}},_renderBubbleChart:function(t,e,a,r){const n=d3.format(",d");const i=Array.from(new Set(r.map(t=>t.group)));const d=d3.scaleOrdinal().domain(i).range(d3.schemeCategory10);const o=d3.pack().size([e-2,a-2]).padding(3);const s=o(d3.hierarchy({children:r}).sum(t=>t.value));t.attr("viewBox",[0,0,e,a]).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle");const l=t.selectAll("g").data(s.leaves()).join("g").attr("transform",t=>`translate(${t.x+1},${t.y+1})`);l.append("circle").attr("r",t=>t.r).attr("fill-opacity",.7).attr("fill",t=>d(t.data.group));l.append("text").text(t=>t.data.name);l.append("title").text(t=>`${t.data.title}\n${n(t.data.value)}`)},_renderBarChart:function(t,e,a,r){const n={top:20,right:30,bottom:40,left:40};const i=e-n.left-n.right;const d=a-n.top-n.bottom;const o=d3.scaleBand().domain(r.map(t=>t.name)).range([0,i]).padding(.1);const s=d3.scaleLinear().domain([0,d3.max(r,t=>t.value)]).nice().range([d,0]);const l=t.append("g").attr("transform",`translate(${n.left},${n.top})`);l.append("g").call(d3.axisLeft(s));l.append("g").attr("transform",`translate(0,${d})`).call(d3.axisBottom(o));l.selectAll("rect").data(r).enter().append("rect").attr("x",t=>o(t.name)).attr("y",t=>s(t.value)).attr("height",t=>d-s(t.value)).attr("width",o.bandwidth()).attr("fill","steelblue")},_renderGroupedBarChart:function(t,e,a,r){const n={top:20,right:30,bottom:50,left:50};const i=e-n.left-n.right;const d=a-n.top-n.bottom;const o=r.map(t=>t.group);const s=r[0]?.values.map(t=>t.category)||[];const l=d3.scaleBand().domain(o).rangeRound([0,i]).paddingInner(.1);const c=d3.scaleBand().domain(s).rangeRound([0,l.bandwidth()]).padding(.05);const h=d3.scaleLinear().domain([0,d3.max(r,t=>d3.max(t.values,t=>t.value))]).nice().rangeRound([d,0]);const p=d3.scaleOrdinal().domain(s).range(d3.schemeCategory10);const g=t.append("g").attr("transform",`translate(${n.left},${n.top})`);g.append("g").call(d3.axisLeft(h));g.append("g").attr("transform",`translate(0,${d})`).call(d3.axisBottom(l));const u=g.selectAll("g.layer").data(r).join("g").attr("class","layer").attr("transform",t=>`translate(${l(t.group)},0)`);u.selectAll("rect").data(t=>t.values).join("rect").attr("x",t=>c(t.category)).attr("y",t=>h(t.value)).attr("width",c.bandwidth()).attr("height",t=>d-h(t.value)).attr("fill",t=>p(t.category))},_renderPieChart:function(t,e,a,r){const n=Math.min(e,a)/2-40;const i=t.append("g").attr("transform",`translate(${e/2}, ${a/2})`);const d=d3.pie().value(t=>t.value).sort(null);const o=d3.arc().innerRadius(0).outerRadius(n);const s=d3.arc().innerRadius(n*.6).outerRadius(n*.6);const l=d3.scaleOrdinal(d3.schemeCategory10);const c=d(r);const h=d3.sum(r,t=>t.value);i.selectAll("path").data(c).enter().append("path").attr("d",o).attr("fill",t=>l(t.data.name)).attr("stroke","white").attr("stroke-width",1.5).append("title").text(t=>`${t.data.name}: ${t.data.value} (${(t.data.value/h*100).toFixed(1)}%)`);i.selectAll("text").data(c).enter().append("text").attr("transform",t=>`translate(${s.centroid(t)})`).attr("text-anchor","middle").attr("font-size","10px").attr("fill","#fff").text(t=>{const e=t.data.value/h*100;return e>=5?`${t.data.name}\n${e.toFixed(1)}%`:""})},_renderMicroDonutChart:function(t,e,a,r){const n="16px";const i="red";const d=Math.min(e,a)/2-10;const o=d*.6;const s=t.append("g").attr("transform",`translate(${e/2}, ${a/2})`);const l=d3.pie().value(t=>t.value).sort(null);const c=d3.arc().innerRadius(o).outerRadius(d);const h=d3.scaleOrdinal(d3.schemeCategory10);const p=l(r);const g=d3.sum(r,t=>t.value);const u=r.length>0?r[0].value:0;const m=g>0?(u/g*100).toFixed(0):"0";s.selectAll("path").data(p).enter().append("path").attr("d",c).attr("fill",t=>h(t.data.name||t.index)).attr("stroke","white").attr("stroke-width",1.5).append("title").text(t=>`${t.data.name||`Slice ${t.index+1}`}: ${t.data.value} (${(t.data.value/g*100).toFixed(1)}%)`);s.append("text").attr("text-anchor","middle").attr("dy","0.35em").style("font-size",n).style("fill",i).text(`${m}%`);s.append("text").attr("text-anchor","middle").attr("dy","1.8em").style("font-size","10px").style("fill","#666").text(r.length>0?r[0].name||"Progress":"")},_renderOrgChart:function(t,e){if(!window.d3||!window.d3.OrgChart){throw new Error("d3-org-chart is not loaded.")}this._orgChart=null;d3.csv("https://raw.githubusercontent.com/bumbeishvili/sample-data/main/data-oracle.csv").then(a=>{this._orgChart=(new d3.OrgChart).nodeHeight(()=>85+25).nodeWidth(()=>220+2).childrenMargin(()=>50).compactMarginBetween(()=>35).compactMarginPair(()=>30).neighbourMargin(()=>20).nodeContent(function(t){const e="#FFFFFF";const a=25+2;return`\n                <div style='width:${t.width}px;height:${t.height}px;padding-top:${a-2}px;padding-left:1px;padding-right:1px'>\n                        <div style="font-family: 'Inter', sans-serif;background-color:${e};  margin-left:-1px;width:${t.width-2}px;height:${t.height-a}px;border-radius:10px;border: ${t.data._highlighted||t.data._upToTheRootHighlighted?'5px solid #E27396"':'1px solid #E4E2E9"'} >\n                            <div style="display:flex;justify-content:flex-end;margin-top:5px;margin-right:8px">#${t.data.id}</div><div style="background-color:${e};margin-top:${-a-20}px;margin-left:${15}px;border-radius:100px;width:50px;height:50px;" ></div>\n                            <div style="margin-top:${-a-20}px;">   <img src=" ${t.data.image}" style="margin-left:${20}px;border-radius:100px;width:40px;height:40px;" /></div>\n                            <div style="font-size:15px;color:#08011E;margin-left:20px;margin-top:10px">  ${t.data.name} </div>\n                            <div style="color:#716E7B;margin-left:20px;margin-top:3px;font-size:10px;"> ${t.data.position} </div>\n                        </div>\n                    </div>`}).container(t).data(a||e).render()})}})});
//# sourceMappingURL=D3Chart.js.map