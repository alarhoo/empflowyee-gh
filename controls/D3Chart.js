sap.ui.define(["sap/ui/core/Control","sap/ui/core/HTML","sap/ui/core/ResizeHandler","sap/m/MessageToast","./../lib/d3.v7.min","./../lib/d3-org-chart","./../lib/d3-flextree"],function(t,e,a,n){"use strict";return t.extend("com.alarhoo.empflowyee.controls.D3Chart",{metadata:{properties:{chartType:{type:"string",defaultValue:"bar"},title:{type:"string",defaultValue:""},height:{type:"string",defaultValue:"400"},xAxisLabel:{type:"string",defaultValue:""},yAxisLabel:{type:"string",defaultValue:""},showLegend:{type:"boolean",defaultValue:false}},aggregations:{htmlContainer:{type:"sap.ui.core.HTML",multiple:false,visibility:"hidden"},data:{type:"sap.ui.base.ManagedObject"}}},init:function(){this._containerId=this.getId()+"--chart-container";this.setAggregation("htmlContainer",new e({content:`<svg id="${this._containerId}" style="height: '100%'"></svg>`}))},exit:function(){if(this._resizeHandlerId){a.deregister(this._resizeHandlerId)}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("d3-chart");t.openEnd();t.renderControl(e.getAggregation("htmlContainer"));t.close("div")}},onBeforeRendering:function(){if(this._resizeHandlerId){a.deregister(this._resizeHandlerId)}},onAfterRendering:function(){this._resizeHandlerId=a.register(this,this._onResize.bind(this));this._renderChart()},_onResize:function(){this._renderChart()},_renderChart:function(){const t=d3.select(`#${this._containerId}`);t.selectAll("*").remove();const e=this.$().width();const a=this.getHeight();t.attr("width",e);t.attr("height",a);try{const n=this.getBinding("data");if(!n){throw new Error("No data binding found.")}const r=n.getContexts().map(t=>t.getObject());if(!Array.isArray(r)||r.length===0){throw new Error("No data found to render chart.")}const o=this.getChartType();switch(o){case"bubble":this._renderBubbleChart(t,e,a,r);break;case"bar":this._renderBarChart(t,e,a,r);break;case"groupedBar":this._renderGroupedBarChart(t,e,a,r);break;case"pie":this._renderPieChart(t,e,a,r);break;case"microDonut":this._renderMicroDonutChart(t,e,a,r);break;case"org":this._renderOrgChart(`#${this._containerId}`,r);break;default:throw new Error(`Unsupported chart type: ${o}`)}if(this.getTitle()){t.append("text").attr("x",e/2).attr("y",20).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text(this.getTitle())}if(this.getXAxisLabel()){t.append("text").attr("x",e/2).attr("y",a-10).attr("text-anchor","middle").text(this.getXAxisLabel())}if(this.getYAxisLabel()){t.append("text").attr("text-anchor","middle").attr("transform",`translate(15, ${a/2}) rotate(-90)`).text(this.getYAxisLabel())}if(this.getShowLegend()){const a=this.getChartType();const r=n.getContexts().map(t=>t.getObject());const o=Array.from(new Set(a==="groupedBar"?r.flatMap(t=>t.values.map(t=>t.category)):r.map(t=>t.name||t.category||t.group)));const i=d3.scaleOrdinal().domain(o).range(d3.schemeCategory10);const d=t.append("g").attr("transform",`translate(${e-120}, 40)`);d.selectAll("rect").data(o).enter().append("rect").attr("x",0).attr("y",(t,e)=>e*20).attr("width",12).attr("height",12).attr("fill",t=>i(t));d.selectAll("text").data(o).enter().append("text").attr("x",18).attr("y",(t,e)=>e*20+10).text(t=>t)}}catch(e){t.append("text").attr("x","50%").attr("y","50%").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("fill","#999").style("font-size","14px").text(`Unable to render chart: ${e.message}`);n.show(`Chart rendering failed: ${e.message}`);console.error(e)}},_renderBubbleChart:function(t,e,a,n){const r=d3.format(",d");const o=Array.from(new Set(n.map(t=>t.group)));const i=d3.scaleOrdinal().domain(o).range(d3.schemeCategory10);const d=d3.pack().size([e-2,a-2]).padding(3);const _=d(d3.hierarchy({children:n}).sum(t=>t.value));t.attr("viewBox",[0,0,e,a]).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle");const s=t.selectAll("g").data(_.leaves()).join("g").attr("transform",t=>`translate(${t.x+1},${t.y+1})`);s.append("circle").attr("r",t=>t.r).attr("fill-opacity",.7).attr("fill",t=>i(t.data.group));s.append("text").text(t=>t.data.name);s.append("title").text(t=>`${t.data.title}\n${r(t.data.value)}`)},_renderBarChart:function(t,e,a,n){const r={top:20,right:30,bottom:40,left:40};const o=e-r.left-r.right;const i=a-r.top-r.bottom;const d=d3.scaleBand().domain(n.map(t=>t.name)).range([0,o]).padding(.1);const _=d3.scaleLinear().domain([0,d3.max(n,t=>t.value)]).nice().range([i,0]);const s=t.append("g").attr("transform",`translate(${r.left},${r.top})`);s.append("g").call(d3.axisLeft(_));s.append("g").attr("transform",`translate(0,${i})`).call(d3.axisBottom(d));s.selectAll("rect").data(n).enter().append("rect").attr("x",t=>d(t.name)).attr("y",t=>_(t.value)).attr("height",t=>i-_(t.value)).attr("width",d.bandwidth()).attr("fill","steelblue")},_renderGroupedBarChart:function(t,e,a,n){const r={top:20,right:30,bottom:50,left:50};const o=e-r.left-r.right;const i=a-r.top-r.bottom;const d=n.map(t=>t.group);const _=n[0]?.values.map(t=>t.category)||[];const s=d3.scaleBand().domain(d).rangeRound([0,o]).paddingInner(.1);const l=d3.scaleBand().domain(_).rangeRound([0,s.bandwidth()]).padding(.05);const c=d3.scaleLinear().domain([0,d3.max(n,t=>d3.max(t.values,t=>t.value))]).nice().rangeRound([i,0]);const m=d3.scaleOrdinal().domain(_).range(d3.schemeCategory10);const p=t.append("g").attr("transform",`translate(${r.left},${r.top})`);p.append("g").call(d3.axisLeft(c));p.append("g").attr("transform",`translate(0,${i})`).call(d3.axisBottom(s));const g=p.selectAll("g.layer").data(n).join("g").attr("class","layer").attr("transform",t=>`translate(${s(t.group)},0)`);g.selectAll("rect").data(t=>t.values).join("rect").attr("x",t=>l(t.category)).attr("y",t=>c(t.value)).attr("width",l.bandwidth()).attr("height",t=>i-c(t.value)).attr("fill",t=>m(t.category))},_renderPieChart:function(t,e,a,n){const r=Math.min(e,a)/2-40;const o=t.append("g").attr("transform",`translate(${e/2}, ${a/2})`);const i=d3.pie().value(t=>t.value).sort(null);const d=d3.arc().innerRadius(0).outerRadius(r);const _=d3.arc().innerRadius(r*.6).outerRadius(r*.6);const s=d3.scaleOrdinal(d3.schemeCategory10);const l=i(n);const c=d3.sum(n,t=>t.value);o.selectAll("path").data(l).enter().append("path").attr("d",d).attr("fill",t=>s(t.data.name)).attr("stroke","white").attr("stroke-width",1.5).append("title").text(t=>`${t.data.name}: ${t.data.value} (${(t.data.value/c*100).toFixed(1)}%)`);o.selectAll("text").data(l).enter().append("text").attr("transform",t=>`translate(${_.centroid(t)})`).attr("text-anchor","middle").attr("font-size","10px").attr("fill","#fff").text(t=>{const e=t.data.value/c*100;return e>=5?`${t.data.name}\n${e.toFixed(1)}%`:""})},_renderMicroDonutChart:function(t,e,a,n){const r="16px";const o="red";const i=Math.min(e,a)/2-10;const d=i*.6;const _=t.append("g").attr("transform",`translate(${e/2}, ${a/2})`);const s=d3.pie().value(t=>t.value).sort(null);const l=d3.arc().innerRadius(d).outerRadius(i);const c=d3.scaleOrdinal(d3.schemeCategory10);const m=s(n);const p=d3.sum(n,t=>t.value);const g=n.length>0?n[0].value:0;const h=p>0?(g/p*100).toFixed(0):"0";_.selectAll("path").data(m).enter().append("path").attr("d",l).attr("fill",t=>c(t.data.name||t.index)).attr("stroke","white").attr("stroke-width",1.5).append("title").text(t=>`${t.data.name||`Slice ${t.index+1}`}: ${t.data.value} (${(t.data.value/p*100).toFixed(1)}%)`);_.append("text").attr("text-anchor","middle").attr("dy","0.35em").style("font-size",r).style("fill",o).text(`${h}%`);_.append("text").attr("text-anchor","middle").attr("dy","1.8em").style("font-size","10px").style("fill","#666").text(n.length>0?n[0].name||"Progress":"")},_renderOrgChart:function(t,e){if(!window.d3||!window.d3.OrgChart){throw new Error("d3-org-chart is not loaded.")}this._orgChart=null;d3.csv("https://raw.githubusercontent.com/bumbeishvili/sample-data/main/data-oracle.csv").then(a=>{console.log(a);a=[{id:"100",name:"Michael",lastName:"Scott",email:"MSCOTT",position:"Regional Manager",job_id:"REG_MGR",job_min_salary:"5000",job_max_salary:"8000",salary:"7500",phone_number:"570.555.0100",department_id:"01",department_name:"Management",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1710",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2001-04-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/d/dc/MichaelScott.png",parentId:"115"},{id:"101",name:"Dwight",lastName:"Schrute",email:"DSCHRUTE",position:"Assistant Regional Manager",job_id:"ASST_MGR",salary:"6000",job_min_salary:"4000",job_max_salary:"7000",phone_number:"570.555.0101",department_id:"02",department_name:"Sales",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1720",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2002-06-15T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/c/cd/Dwight_Schrute.jpg",parentId:"100"},{id:"102",name:"Jim",lastName:"Halpert",email:"JHALPERT",position:"Sales Representative",job_id:"SALES_REP",salary:"4500",job_min_salary:"3000",job_max_salary:"6000",phone_number:"570.555.0102",department_id:"02",department_name:"Sales",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1720",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-03-20T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/7/7e/Jim-halpert.jpg",parentId:"101"},{id:"103",name:"Pam",lastName:"Beesly",email:"PBEESLY",position:"Receptionist",job_id:"RECEP",salary:"3000",job_min_salary:"2500",job_max_salary:"4000",phone_number:"570.555.0103",department_id:"03",department_name:"Administration",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1730",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-01-15T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/6/67/Pam_Beesley.jpg",parentId:"100"},{id:"104",name:"Angela",lastName:"Martin",email:"AMARTIN",position:"Senior Accountant",job_id:"ACC_SNR",salary:"4200",job_min_salary:"3000",job_max_salary:"5000",phone_number:"570.555.0104",department_id:"04",department_name:"Accounting",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1740",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-07-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/0/0b/Angela_Martin.jpg",parentId:"100"},{id:"105",name:"Kevin",lastName:"Malone",email:"KMALONE",position:"Accountant",job_id:"ACC",salary:"3500",job_min_salary:"2500",job_max_salary:"4500",phone_number:"570.555.0105",department_id:"04",department_name:"Accounting",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1740",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2004-03-12T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/6/60/Office-1200-baumgartner1.jpg",parentId:"104"},{id:"106",name:"Oscar",lastName:"Martinez",email:"OMARTINEZ",position:"Accountant",job_id:"ACC",salary:"3700",job_min_salary:"2500",job_max_salary:"4500",phone_number:"570.555.0106",department_id:"04",department_name:"Accounting",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1740",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2004-04-10T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/5/54/Oscar_Martinez_of_The_Office.jpg",parentId:"104"},{id:"107",name:"Stanley",lastName:"Hudson",email:"SHUDSON",position:"Sales Representative",job_id:"SALES_REP",salary:"4600",job_min_salary:"3000",job_max_salary:"6000",phone_number:"570.555.0107",department_id:"02",department_name:"Sales",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1720",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2002-11-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/9/91/Ryan_Howard_%28The_Office%29.jpg",parentId:"101"},{id:"108",name:"Meredith",lastName:"Palmer",email:"MPALMER",position:"Supplier Relations",job_id:"SUPPLY_REP",salary:"3100",job_min_salary:"2500",job_max_salary:"4000",phone_number:"570.555.0108",department_id:"05",department_name:"Purchasing",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1750",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-09-01T00:00:00.000Z",image:"https://www.peacocktv.com/dam/growth/assets/Library/TheOffice/office-character-meredith-min.png",parentId:"100"},{id:"109",name:"Kelly",lastName:"Kapoor",email:"KKAPOOR",position:"Customer Service Rep",job_id:"CUST_SERV",salary:"3200",job_min_salary:"2500",job_max_salary:"4000",phone_number:"570.555.0109",department_id:"06",department_name:"Customer Relations",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1760",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-10-12T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/6/69/Kelly_Kapoor.jpg",parentId:"100"},{id:"110",name:"Creed",lastName:"Bratton",email:"CBRATTON",position:"Quality Assurance",job_id:"QA",salary:"3600",job_min_salary:"2800",job_max_salary:"4600",phone_number:"570.555.0110",department_id:"07",department_name:"Quality Control",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1770",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2002-08-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Creed_Bratton_2019_%2848474439927%29_CROPPED.jpg/500px-Creed_Bratton_2019_%2848474439927%29_CROPPED.jpg",parentId:"100"},{id:"111",name:"Andy",lastName:"Bernard",email:"ABERNARD",position:"Sales Director",job_id:"SALES_DIR",salary:"5200",job_min_salary:"4000",job_max_salary:"7000",phone_number:"570.555.0111",department_id:"02",department_name:"Sales",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1720",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2005-02-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/8/84/Andy_Bernard_photoshot.jpg",parentId:"100"},{id:"112",name:"Toby",lastName:"Flenderson",email:"TFLENDERSON",position:"HR Representative",job_id:"HR_REP",salary:"4000",job_min_salary:"3000",job_max_salary:"5000",phone_number:"570.555.0112",department_id:"08",department_name:"Human Resources",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1780",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2002-10-01T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/PaulLieberstein.jpg/500px-PaulLieberstein.jpg",parentId:"100"},{id:"113",name:"Ryan",lastName:"Howard",email:"RHOWARD",position:"Temp",job_id:"TEMP",salary:"2800",job_min_salary:"2000",job_max_salary:"3500",phone_number:"570.555.0113",department_id:"02",department_name:"Sales",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1720",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2004-01-10T00:00:00.000Z",image:"https://upload.wikimedia.org/wikipedia/en/9/91/Ryan_Howard_%28The_Office%29.jpg",parentId:"101"},{id:"114",name:"Darryl",lastName:"Philbin",email:"DPHILBIN",position:"Warehouse Manager",job_id:"WARE_MGR",salary:"4300",job_min_salary:"3000",job_max_salary:"5000",phone_number:"570.555.0114",department_id:"09",department_name:"Warehouse",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1790",department_location_postal_code:"18505",department_location_street_address:"1725 Slough Ave",location_state:"Pennsylvania",hire_date:"2003-06-01T00:00:00.000Z",image:"https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcSw7fJbskykoOb9Xp8QTnn_gcxGuhM7GjCMuu1VliRNt9nC_24iCuZg-Cx9PRiCw_iPQ7LBYSQqF0rEGehq3um5saFP0BktExFk94RKrw",parentId:"100"},{id:"115",name:"Jan",lastName:"Levinson",email:"JLEVINSON",position:"VP, Northeast Sales",job_id:"VP_SALES",salary:"8500",job_min_salary:"7000",job_max_salary:"9500",phone_number:"212.555.0115",department_id:"10",department_name:"Corporate",department_location_country_id:"US",department_location_country_name:"United States of America",department_location_country_region_id:"2",department_location_country_region_name:"Americas",department_location_id:"1800",department_location_postal_code:"10001",department_location_street_address:"123 Corporate Plaza",location_state:"New York",hire_date:"1999-01-01T00:00:00.000Z",image:"https://static.wikia.nocookie.net/loveinterest/images/4/49/Jan-the-office--28us-29-34544_895_1024.jpg",parentId:null}];console.log(a);this._orgChart=(new d3.OrgChart).nodeHeight(()=>85+25).nodeWidth(()=>220+2).childrenMargin(()=>50).compactMarginBetween(()=>35).compactMarginPair(()=>30).neighbourMargin(()=>20).nodeContent(function(t){const e="#FFFFFF";const a=25+2;return`\n                <div style='width:${t.width}px;height:${t.height}px;padding-top:${a-2}px;padding-left:1px;padding-right:1px'>\n                        <div style="font-family: 'Inter', sans-serif;background-color:${e};  margin-left:-1px;width:${t.width-2}px;height:${t.height-a}px;border-radius:10px;border: ${t.data._highlighted||t.data._upToTheRootHighlighted?'5px solid #E27396"':'1px solid #E4E2E9"'}>\n                            <div style="display:flex;justify-content:flex-end;margin-top:5px;margin-right:8px">#${t.data.id}</div><div style="background-color:${e};margin-top:${-a-20}px;margin-left:${15}px;border-radius:100px;width:50px;height:50px;"></div><div style="margin-top:${-a-20}px;">   <img src=" ${t.data.image}" style="margin-left:${20}px;border-radius:100px;width:40px;height:40px;" /></div><div style="font-size:15px;color:#08011E;margin-left:20px;margin-top:10px">  ${t.data.name} </div><div style="color:#716E7B;margin-left:20px;margin-top:3px;font-size:10px;"> ${t.data.position} </div>\n                        </div>\n                    </div>`}).container(t).data(a||e).render()})}})});
//# sourceMappingURL=D3Chart.js.map