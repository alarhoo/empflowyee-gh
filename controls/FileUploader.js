sap.ui.define(["sap/ui/core/Control","sap/ui/core/Fragment","sap/m/PDFViewer","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/Image"],function(e,t,o,i,n,r,s){"use strict";return e.extend("com.alarhoo.empflowyee.controls.FileUploader",{metadata:{properties:{label:{type:"string"},documentSource:{type:"string",bindable:true},fileName:{type:"string",bindable:true},fileType:{type:"string",defaultValue:"pdf"},maxFileSize:{type:"int",defaultValue:2}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{change:{parameters:{file:{type:"object"},name:{type:"string"},size:{type:"int"},type:{type:"string"}}}},interfaces:["sap.ui.core.IFormContent"]},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("fileUploaderControl");e.openEnd();e.renderControl(t.getAggregation("_content"));e.close("div")}},init:function(){this._pdfViewer=new o({isTrustedSource:true,showDownloadButton:false});this._imageDialog=null},onBeforeRendering:function(){if(this._bFragmentLoaded||this.getAggregation("_content"))return;this._bFragmentLoaded=true;t.load({name:"com.alarhoo.empflowyee.controls.FileUploaderContent",controller:this}).then(function(e){const t=this.getLabel();const o=`Upload ${t||"document"}`;const i=this.getFileType();const r=this.getMaxFileSize();const s=`Only ${i} files up to ${r}MB are allowed.`;const l=new n({label:this.getLabel(),placeholder:o,tooltip:s,documentSource:this.getDocumentSource(),fileName:this.getFileName(),fileType:i});this.setModel(l,"control");e.setModel(l,"control");this.setAggregation("_content",e)}.bind(this)).catch(function(e){console.error("Failed to load FileUploader fragment:",e)})},onFileUploadChange:function(e){try{const t=e.getSource();const o=e.getParameter("files")?.[0];const n=this.getMaxFileSize()*1024*1024;if(!o){i.show("No file selected.");return}if(o.size>n){i.show(`File size exceeds ${this.getMaxFileSize()}MB limit.`);t.clear();return}const r=new FileReader;r.onload=e=>{const t=e.target.result;const i=this.getModel("control");i.setProperty("/documentSource",t);i.setProperty("/fileName",o.name);i.setProperty("/fileMimeType",o.type);i.setProperty("/fileSize",(o.size/1024).toFixed(1)+" KB");this.fireChange({file:o,name:o.name,size:o.size,type:o.type})};r.onerror=()=>{console.error("File read failed");i.show("Failed to read file")};r.readAsDataURL(o)}catch(e){console.error("Upload error:",e);i.show("Something went wrong")}},onFileTypeMismatch:function(e){const t=e.getSource().getFileType()||[];const o=t.map(e=>"*."+e).join(", ");const n=e.getParameter("fileType");i.show(`The file type *.${n} is not supported. Choose one of the following types: ${o}`)},onPreviewPress:function(){const e=this.getModel("control");const t=e.getProperty("/documentSource");const o=e.getProperty("/fileName");const n=e.getProperty("/fileMimeType");if(!t){i.show("No file to preview");return}if(n&&n.startsWith("image/")){if(!this._imageDialog){this._imageDialog=new r({title:o||"Image Preview",content:[new s({src:t,width:"100%",densityAware:false})],endButton:new sap.m.Button({text:"Close",press:function(){this._imageDialog.close()}.bind(this)}),afterClose:function(){this._imageDialog.destroy();this._imageDialog=null}.bind(this)})}else{this._imageDialog.setTitle(o||"Image Preview");this._imageDialog.getContent()[0].setSrc(t)}this._imageDialog.open()}else if(n==="application/pdf"){this._pdfViewer.setSource(t);this._pdfViewer.setTitle(o||"Preview");this._pdfViewer.open()}else{i.show("Preview not supported for this file type.")}},onClearUpload:function(){const e=this.getModel("control");e.setProperty("/documentSource",null);e.setProperty("/fileName",null);e.setProperty("/fileSize",null);const t=this.getAggregation("_content");if(t){const e=t.findAggregatedObjects(true).filter(e=>e.isA("sap.ui.unified.FileUploader"));if(e.length>0){e[0].clear()}}},getFormDoNotAdjustWidth:function(){return false}})});
//# sourceMappingURL=FileUploader.js.map