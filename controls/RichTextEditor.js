sap.ui.define(["sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/base/Log"],function(e,t,i){"use strict";const n=sap.ui.require.toUrl("com/alarhoo/empflowyee/lib/tinymce");return e.extend("com.alarhoo.empflowyee.controls.RichTextEditor",{metadata:{properties:{value:{type:"string",defaultValue:""},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"600px"},editorId:{type:"string",defaultValue:null},config:{type:"object",defaultValue:{}}},events:{change:{parameters:{value:{type:"string"}}},ready:{}}},init:function(){this._editorId=this.getId()+"-rte";this._editor=null;this._tinymceLoaded=false;this._resizeHandlerId=null},renderer:function(e,t){e.openStart("div",t);e.style("width",t.getWidth());e.style("height",t.getHeight());e.class(t.getMetadata().getName());e.openEnd();e.openStart("textarea",t.getEditorId()||t._editorId);e.openEnd();e.text(t.getValue()||"");e.close("textarea");e.close("div")},onAfterRendering:function(){const e=this.getEditorId()||this._editorId;if(window.tinymce?.get(e)){window.tinymce.get(e).remove()}if(!this._tinymceLoaded){this._loadTinyMCE(e)}else{this._initTinyMCE(e)}if(!this._resizeHandlerId){this._resizeHandlerId=t.register(this,this._onResize.bind(this))}},_loadTinyMCE:function(e){const t=`${n}/tinymce.min.js`;const s=document.createElement("script");s.src=t;s.async=true;s.onload=()=>{this._tinymceLoaded=true;this._initTinyMCE(e)};s.onerror=e=>{i.error("TinyMCE script load failed:",e.message);this.fireEvent("error",{message:"Failed to load TinyMCE editor."})};document.head.appendChild(s)},_initTinyMCE:function(e){if(typeof tinymce==="undefined"){i.warning("TinyMCE is not available.");return}const t={selector:`#${e}`,base_url:n,suffix:".min",height:this.getHeight(),plugins:"advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table code help wordcount",toolbar:"undo redo | formatselect | bold italic backcolor | blocks fontsizeinput | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | fullscreen image link math media | removeformat preview | help",skin:window.matchMedia("(prefers-color-scheme: dark)").matches?"oxide-dark":"oxide",content_css:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"default",branding:false,menubar:false,resize:false,init_instance_callback:e=>{this._editor=e;if(this.getValue()){this._editor.setContent(this.getValue())}this.fireReady();e.on("change keyup",()=>{const t=e.getContent();if(this.getValue()!==t){this.setProperty("value",t,true);this.fireChange({value:t})}})},...this.getConfig()};tinymce.init(t).then(e=>{if(e?.length>0&&!this._editor){this._editor=e[0]}}).catch(e=>{i.error("TinyMCE init failed:",e.message);this.fireEvent("error",{message:"TinyMCE initialization failed."})})},setValue:function(e){if(this._editor&&this._editor.initialized&&this._editor.getContent()!==e){this._editor.setContent(e)}return this.setProperty("value",e,true)},_onResize:function(){if(this._editor&&!this._editor.isHidden()){const e=this.getDomRef();if(e){this._editor.execCommand("mceResize",false,{width:e.offsetWidth,height:e.offsetHeight})}}},exit:function(){if(this._editor){this._editor.remove();this._editor=null}if(this._resizeHandlerId){t.deregister(this._resizeHandlerId);this._resizeHandlerId=null}if(e.prototype.exit){e.prototype.exit.apply(this,arguments)}}})});
//# sourceMappingURL=RichTextEditor.js.map